<div class="content-section">
    <header class="content-section-header">多条件搜索</header>
    <form class="form-inline" novalidate name="searchForm">
        <div class="form-line">
            <div class="form-group">
                <label for="order-sn">订单号：</label>
                <input type="text" class="form-control" id="order-sn" ng-model="orders.searchParam.policySn">
            </div>
            <div class="form-group">
                <label for="order-plate">车牌号：</label>
                <input type="text" class="form-control" id="order-plate" ng-model="orders.searchParam.carNumber">
            </div>
            <div class="form-group">
                <label for="order-sn">保险师手机号：</label>
                <input type="text" class="form-control" id="order-sn" ng-model="orders.searchParam.mobile">
            </div>
        </div>
        <div class="form-line">
            <div class="form-group">
                <label>时间段：</label>
                <div class="input-group">
                    <input type="text" class="form-control" uib-datepicker-popup ng-model="orders.searchParam.sTime" is-open="orders.datePickerOpened.sTime" ng-datepicker-options="orders.datepickerOptions" clear-text="清空" current-text="今天" close-text="关闭" ng-click="orders.datePickerOpened.sTime = true" />
                    <span class="input-group-addon" id="basic-addon1">0点</span>
                </div>
                <label> —— </label>
                <div class="input-group">
                <input type="text" class="form-control" uib-datepicker-popup ng-model="orders.searchParam.eTime" is-open="orders.datePickerOpened.eTime" ng-datepicker-options="orders.datepickerOptions" clear-text="清空" current-text="今天" close-text="关闭" ng-click="orders.datePickerOpened.eTime = true" />
                    <span class="input-group-addon" id="basic-addon1">24点</span>
                </div>
            </div>
            <button class="btn btn-primary" ng-click="orders.search(searchForm)">
                <span class="glyphicon glyphicon-search"></span>
            </button>
            <div class="form-group pull-right lead">
                <label for="order-sn">订单数量：</label>
                <p class="form-control-static text-primary" ng-bind="orders.paginationOptions.count"></p>
            </div>
        </div>
    </form>
</div>
<div class="table-responsive content-section">
    <table class="table table-striped table-orders">
        <thead>
            <tr>
                <th>序号</th>
                <!-- (#index) -->
                <th>订单号</th>
                <!-- (policySn) -->
                <th class="date-column" ng-if="orders.showOrdersProp('createDate')">生成时间</th>
                <!-- (createDate) -->
                <th class="date-column" ng-if="orders.showOrdersProp('subOrderTime')">提交订单时间</th>
                <!-- (subOrderTime) -->
                <th class="date-column" ng-if="orders.showOrdersProp('quotesTime')">{{orders.searchParam.policyStatus == 300 ? '确认时间' : '报价时间'}}</th>
                <!-- (quotesTime) 在大地系统中显示为“确认时间” -->
                <th ng-if="orders.showOrdersProp('effectTime')">付款剩余时间</th>
                <!-- (effectTime - now) -->
                <th ng-if="orders.showOrdersProp('payTime')">支付时间</th>
                <!-- (payTime) -->
                <th ng-if="orders.showOrdersProp('underwriteTime')">核保时间</th>
                <!-- (underwriteTime) -->
                <th ng-if="orders.showOrdersProp('writerTime')">出单时间</th>
                <!-- (writerTime) -->
                <th ng-if="orders.showOrdersProp('offGroup')">关闭时间</th>
                <!-- (offTime) -->
                <th ng-if="orders.showOrdersProp('refundGroup')">执行退款时间</th>
                <!-- (refundTime) -->
                <th ng-if="orders.showOrdersProp('policyStatus')">订单状态</th>
                <!-- (policyStatus|) -->
                <th>车牌号</th>
                <!-- (carNumber) -->
                <th>保险公司</th>
                <!-- (company) -->
                <th ng-if="orders.showOrdersProp('brokerGroup')">保险师</th>
                <!-- (nickName) -->
                <th ng-if="orders.showOrdersProp('brokerGroup')">手机</th>
                <!-- (mobile) -->
                <th ng-if="orders.showOrdersProp('contactGroup')">联系人</th>
                <!-- (nickName) -->
                <th ng-if="orders.showOrdersProp('contactGroup')">手机</th>
                <!-- (mobile) -->
                <th ng-if="orders.showOrdersProp('quotesUser')">报价人</th>
                <!-- (quotesUser) -->
                <th ng-if="orders.showOrdersProp('underwriteUser')">核保人</th>
                <!-- (underwriteUser) -->
                <th ng-if="orders.showOrdersProp('writerUser')">出单人</th>
                <!-- (writerUser) -->
                <th ng-if="orders.showOrdersProp('offGroup')">关闭类型</th>
                <!-- (offUser |) -->
                <th ng-if="orders.showOrdersProp('offGroup')">关闭人</th>
                <!-- (offUser) -->
                <th ng-if="orders.showOrdersProp('refundGroup')">退款人</th>
                <!-- (refundUser) -->
                <th>订单详情</th>
                <!-- (policyUuid>) -->
                <th ng-if="orders.showOrdersProp('followUpGroup')">跟进状态</th>
                <!-- (followUpStatus) -->
                <th ng-if="orders.showOrdersProp('followUpGroup')">跟进人</th>
                <!-- (followUpUser) -->
                <th ng-if="orders.showOrdersProp('followUpGroup')">跟进时间</th>
                <!-- (followUpTime) -->
                <th ng-if="orders.showOrdersProp('operate')">操作</th>
            </tr>
        </thead>
        <tbody>
            <tr current-page="orders.paginationOptions.currentPage" total-items="orders.paginationOptions.count" dir-paginate="order in orders.searchResult | itemsPerPage:orders.paginationOptions.pageSize">
                <td>{{ ($index + 1) + (orders.paginationOptions.currentPage - 1) * orders.paginationOptions.pageSize}}</td>
                <td class="text-nowrap">{{order.policySn}}</td>
                <td ng-if="orders.showOrdersProp('createDate')" class="date-column">{{order.createDate | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                <td class="date-column" ng-if="orders.showOrdersProp('subOrderTime')">{{order.subOrderTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                <td class="date-column" ng-if="orders.showOrdersProp('quotesTime')">{{order.quotesTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                <td class="text-nowrap" ng-if="orders.showOrdersProp('effectTime')">
                    <span ng-if="order.effectTime" countdown end-date="{{order.effectTime}}" units="days|hours|minutes" lang="CN"></span>
                    <span ng-if="!order.effectTime">无信息</span>                    
                </td>
                <td class="date-column" ng-if="orders.showOrdersProp('payTime')">{{order.payTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                <td class="date-column" ng-if="orders.showOrdersProp('underwriteTime')">{{order.underwriteTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                <td class="date-column" ng-if="orders.showOrdersProp('writerTime')">{{order.writerTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                <td class="date-column" ng-if="orders.showOrdersProp('offGroup')">{{order.offTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                <td class="date-column" ng-if="orders.showOrdersProp('refundGroup')">{{order.refundTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                <td ng-if="orders.showOrdersProp('policyStatus')" class="text-nowrap">{{order.policyStatus | orderStatus}}</td>
                <td class="text-nowrap">{{order.carNumber || '未上牌'}}</td>
                <td>{{order.company}}</td>
                <td ng-if="orders.showOrdersProp('brokerGroup')" class="text-nowrap">{{order.nickName}}</td>
                <td ng-if="orders.showOrdersProp('brokerGroup')" class="text-nowrap">{{order.mobile}}</td>
                <td ng-if="orders.showOrdersProp('contactGroup')">{{order.carName}}</td>
                <td ng-if="orders.showOrdersProp('contactGroup')" class="text-nowrap">{{order.carMobile}}</td>
                <td ng-if="orders.showOrdersProp('quotesUser')"><button class="btn btn-link" ng-click="orders.findUser(order.quotesUserId)">{{order.quotesUser}}</button></td>
                <td ng-if="orders.showOrdersProp('underwriteUser')"><button class="btn btn-link" ng-click="orders.findUser(order.underwriteUserId)">{{order.underwriteUser}}</button></td>
                <td ng-if="orders.showOrdersProp('writerUser')"><button class="btn btn-link" ng-click="orders.findUser(order.writerUserId)">{{order.writerUser || order.policyStatus == 200 && '系统' || ''}}</button></td>
                <td ng-if="orders.showOrdersProp('offGroup')">{{order.offUser ? '人工关闭' : '系统关闭'}}</td>
                <td ng-if="orders.showOrdersProp('offGroup')"><button class="btn btn-link" ng-click="orders.findUser(order.offUserId)">{{order.offUser}}</button></td>
                <td ng-if="orders.showOrdersProp('refundGroup')"><button class="btn btn-link" ng-click="orders.findUser(order.refundUserId)">{{order.refundUser}}</button></td>
                <td>
                    <button class="btn btn-link" ng-click="orders.showDetail(order)">查看</button>
                </td>
                <td ng-if="orders.showOrdersProp('followUpGroup')">
                    <button class="btn btn-link" ng-click="orders.followup(order)">{{order.followUpStatus | orderFollowupStatus}}</button>
                </td>
                <td ng-if="orders.showOrdersProp('followUpGroup')"><button class="btn btn-link" ng-click="orders.findUser(order.followUpUserId)">{{order.followUpUser}}</button></td>
                <td class="date-column" ng-if="orders.showOrdersProp('followUpGroup')">{{order.followUpTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                <td class="text-nowrap" ng-if="orders.showOrdersProp('operate')">
                    <button class="btn btn-link" ng-click="orders.confirmPrice(order)" ng-if="orders.showOrdersProp('bTnPrice')">确定报价</button>
                    <button class="btn btn-link" ng-click="orders.failPrice(order)" ng-if="orders.showOrdersProp('bTnPrice')">报价失败</button>
                    <button class="btn btn-link" ng-click="orders.confirmUnderwrite(order)" ng-if="orders.showOrdersProp('bTnUnderwrite')">核保通过</button>
                    <button class="btn btn-link" ng-click="orders.rejectUnderwrite(order)" ng-if="orders.showOrdersProp('bTnUnderwrite')">核保不通过</button>
                    <button class="btn btn-link" ng-click="orders.confirmIssue(order)" ng-if="orders.showOrdersProp('bTnIssue')">已出单</button>
                    <button class="btn btn-link" ng-click="orders.refund(order)" ng-if="orders.showOrdersProp('bTnRefund')">退款</button>
                    <button class="btn btn-link" ng-click="orders.closeOrder(order)" ng-if="orders.showOrdersProp('bTnClose')">关闭订单</button>
                    <button class="btn btn-link" ng-click="orders.remark(order)">备注</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div>
    <dir-pagination-controls max-size="5" direction-links="true" boundary-links="false" on-page-change="orders.search()" class="pull-right"></dir-pagination-controls>
</div>
